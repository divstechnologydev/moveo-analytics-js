!function(t){if(t.MoveoOne)return;class e{constructor(e){this.token=e,this.userId="",this.buffer=[],this.flushInterval=1e4,this.maxThreshold=500,this.context=t.location.pathname,this.sessionId=this.generateUUID(),this.started=!1,this.pendingUpdates=[],this.meta={},this.additionalMetadata={},this.currentViewport={width:t.innerWidth,height:t.innerHeight},setInterval((()=>this.flush()),this.flushInterval)}initialize(){this.start(),this.setupClickTracking(),this.setupScrollTracking(),this.setupFormTracking(),this.setupResizeTracking()}identify(t){this.userId=t}setLocale(t){this.meta.locale=t,this.queueOrSendUpdate("meta")}setTest(t){this.meta.test=t,this.queueOrSendUpdate("meta")}setSoftwareVersion(t){this.meta.softwareVersion=t,this.queueOrSendUpdate("meta")}queueOrSendUpdate(t){this.started?"meta"===t?this.addUpdateMetadataEvent():"additional"===t&&this.addUpdateAdditionalMetadataEvent():this.pendingUpdates.push(t)}processPendingUpdates(){[...new Set(this.pendingUpdates)].forEach((t=>{"meta"===t?this.addUpdateMetadataEvent():"additional"===t&&this.addUpdateAdditionalMetadataEvent()})),this.pendingUpdates=[]}addUpdateMetadataEvent(){const t={c:this.context,type:"update_metadata",userId:this.userId,t:Date.now(),prop:{},meta:{...this.meta},additionalMetadata:{...this.additionalMetadata},sId:this.sessionId};this.buffer.push(t),this.flushOrRecord(!1)}updateAdditionalMetadata(t){this.additionalMetadata={...this.additionalMetadata,...t},this.queueOrSendUpdate("additional")}addUpdateAdditionalMetadataEvent(){const t={c:this.context,type:"update_additional_metadata",userId:this.userId,t:Date.now(),prop:{},meta:{...this.meta},additionalMetadata:{...this.additionalMetadata},sId:this.sessionId};this.buffer.push(t),this.flushOrRecord(!1)}updateMetadata(t){this.updateAdditionalMetadata(t)}flushOrRecord(t=!1){(t||this.buffer.length>=this.maxThreshold)&&this.flush()}track(t,e){const a={c:this.context,type:"track",userId:this.userId,t:Date.now(),prop:{sg:e.semanticGroup,eID:e.id,eA:e.action,eT:e.type,eV:e.value||""},meta:Object.keys(this.meta).length>0?{...this.meta}:{},additionalMetadata:{...this.additionalMetadata},sId:this.sessionId};e.metadata&&(a.additionalMetadata={...a.additionalMetadata,...e.metadata}),this.buffer.push(a),this.buffer.length>=this.maxThreshold&&this.flush()}enrichWithGeolocation(){return fetch("https://ipapi.co/json/").then((t=>t.json())).then((t=>({location:t.country_name||""}))).catch((t=>(console.warn("MoveoOne: Failed to enrich geolocation",t),{location:""})))}async start(){const e={c:this.context,type:"start_session",userId:this.userId,t:Date.now(),prop:{},meta:{...this.meta},additionalMetadata:{...this.additionalMetadata},sId:this.sessionId},a=new URLSearchParams(t.location.search),i={utm_source:a.get("utm_source")||"",utm_medium:a.get("utm_medium")||"",utm_campaign:a.get("utm_campaign")||"",utm_term:a.get("utm_term")||"",utm_content:a.get("utm_content")||""},n="true"===localStorage.getItem("moveo-returning");n||localStorage.setItem("moveo-returning","true");const s={userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language||navigator.userLanguage,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,referrer:document.referrer||"",returningVisitor:n},o={screenWidth:t.screen.width,screenHeight:t.screen.height,screenColorDepth:t.screen.colorDepth,viewportWidth:t.innerWidth,viewportHeight:t.innerHeight,devicePixelRatio:t.devicePixelRatio||1},r=await this.enrichWithGeolocation();e.additionalMetadata={...e.additionalMetadata,...i,...s,...o,...r,url:t.location.href,title:document.title},this.additionalMetadata={...this.additionalMetadata,...e.additionalMetadata},this.buffer.push(e),this.started=!0,this.processPendingUpdates(),this.flush(),this.track("page_view",{semanticGroup:"navigation",id:t.location.pathname,type:"page",action:"view",value:document.title})}flush(){if(0===this.buffer.length)return;const t=[...this.buffer];this.buffer=[],console.log("MoveoOne: Sending events",t),t.forEach(((t,e)=>{console.log(`Event ${e}:`,{type:t.type,meta:t.meta,additionalMetadata:t.additionalMetadata})})),fetch("https://api.moveo.one/api/analytic/event",{method:"POST",headers:{Authorization:this.token,"Content-Type":"application/json"},body:JSON.stringify({events:t})}).catch((t=>console.error("MoveoOne Error:",t)))}setupClickTracking(){document.addEventListener("click",(t=>{let e=t.target,a=e.tagName.toLowerCase();if(!["a","button","input","select"].includes(a)){if(e=e.closest('a, button, input[type="button"], input[type="submit"], select'),!e)return;a=e.tagName.toLowerCase()}const i={semanticGroup:"interaction",id:e.id||e.name||e.href||"unnamed_element",type:a,action:"click",value:e.textContent?.trim()||e.value||"",metadata:{path:this.getElementPath(e),href:e.href||"",className:e.className||"",coordinates:`${t.clientX},${t.clientY}`}};this.track("click",i)}))}setupScrollTracking(){let e,a=0;t.addEventListener("scroll",(()=>{clearTimeout(e),e=setTimeout((()=>{const e=t.scrollY,i=document.documentElement.scrollHeight-t.innerHeight,n=Math.round(e/i*100);Math.abs(e-a)>100&&(this.track("scroll",{semanticGroup:"interaction",id:"page_scroll",type:"scroll",action:"scroll",value:n.toString(),metadata:{position:e,percentage:n,documentHeight:i+t.innerHeight}}),a=e)}),500)}))}setupFormTracking(){document.addEventListener("submit",(t=>{const e=t.target;this.track("form_submit",{semanticGroup:"interaction",id:e.id||e.name||"unnamed_form",type:"form",action:"submit",value:"",metadata:{path:this.getElementPath(e),method:e.method||"get",action:e.action||""}})})),document.addEventListener("change",(t=>{const e=t.target;["select","input","textarea"].includes(e.tagName.toLowerCase())&&this.track("form_change",{semanticGroup:"interaction",id:e.id||e.name||"unnamed_input",type:e.type||e.tagName.toLowerCase(),action:"change",value:"password"===e.type?"[REDACTED]":e.value,metadata:{path:this.getElementPath(e),fieldType:e.type||e.tagName.toLowerCase()}})}))}setupResizeTracking(){let e;t.addEventListener("resize",(()=>{clearTimeout(e),e=setTimeout((()=>{const e={width:t.innerWidth,height:t.innerHeight};(Math.abs(e.width-this.currentViewport.width)>50||Math.abs(e.height-this.currentViewport.height)>50)&&(this.track("viewport_resize",{semanticGroup:"interaction",id:"viewport_change",type:"resize",action:"resize",value:`${e.width}x${e.height}`,metadata:{oldSize:`${this.currentViewport.width}x${this.currentViewport.height}`,newSize:`${e.width}x${e.height}`,widthChange:e.width-this.currentViewport.width,heightChange:e.height-this.currentViewport.height}}),this.currentViewport=e)}),300)}))}getElementPath(t){const e=[];for(;t&&t.nodeType===Node.ELEMENT_NODE;){let a=t.nodeName.toLowerCase();t.id?a+="#"+t.id:t.className&&(a+="."+t.className.replace(/\s+/g,".")),e.unshift(a),t=t.parentNode}return e.join(" > ")}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}}t.MoveoOne={init:function(a,i={}){const n=new e(a),s=["locale","test","softwareVersion"];return Object.keys(i).forEach((t=>{if(s.includes(t))switch(t){case"locale":"string"==typeof i[t]&&(n.meta.locale=i[t]);break;case"test":"string"==typeof i[t]&&(n.meta.test=i[t]);break;case"softwareVersion":"string"==typeof i[t]&&(n.meta.softwareVersion=i[t])}else console.warn(`MoveoOne: Invalid meta field "${t}" ignored. Allowed fields: ${s.join(", ")}`)})),n.initialize(),t.MoveoOne.instance=n,n}}}(window);