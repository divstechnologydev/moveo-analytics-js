!function(t){if(t.MoveoOne)return;const e="https://api.moveo.one/api/analytic/event";class a{constructor(e){this.token=e,this.userId="",this.buffer=[],this.flushInterval=5e3,this.maxThreshold=500,this.context="WEB_STATIC",this.sessionId=this.getOrCreateSessionId(),this.started=!1,this.pendingUpdates=[],this.meta={},this.additionalMetadata={},this.currentViewport={width:t.innerWidth,height:t.innerHeight},this.isPageNavigation=this.checkIfPageNavigation(),setInterval((()=>this.flush()),this.flushInterval)}getOrCreateSessionId(){const t="moveo-session-id",e="moveo-session-timestamp",a=localStorage.getItem(t),i=localStorage.getItem(e);if(a&&i){const t=Date.now();if(t-parseInt(i,10)<18e5)return localStorage.setItem(e,t.toString()),a}const n=this.generateUUID();return localStorage.setItem(t,n),localStorage.setItem(e,Date.now().toString()),n}checkIfPageNavigation(){const e="moveo-last-path",a=localStorage.getItem(e),i=t.location.pathname;return localStorage.setItem(e,i),a&&a!==i}updateSessionActivity(){localStorage.setItem("moveo-session-timestamp",Date.now().toString())}initialize(){this.start(),this.setupClickTracking(),this.setupScrollTracking(),this.setupFormTracking(),this.setupResizeTracking(),this.setupPageUnloadTracking(),this.setupOutboundAndDownloadTracking()}identify(t){this.userId=t}setLocale(t){this.meta.locale=t,this.queueOrSendUpdate("meta")}setTest(t){this.meta.test=t,this.queueOrSendUpdate("meta")}setSoftwareVersion(t){this.meta.softwareVersion=t,this.queueOrSendUpdate("meta")}queueOrSendUpdate(t){this.started?"meta"===t?this.addUpdateMetadataEvent():"additional"===t&&this.addUpdateAdditionalMetadataEvent():this.pendingUpdates.push(t)}processPendingUpdates(){[...new Set(this.pendingUpdates)].forEach((t=>{"meta"===t?this.addUpdateMetadataEvent():"additional"===t&&this.addUpdateAdditionalMetadataEvent()})),this.pendingUpdates=[]}addUpdateMetadataEvent(){const t={c:this.context,type:"update_metadata",userId:this.userId,t:Date.now(),prop:{},meta:{...this.meta},additionalMetadata:{...this.additionalMetadata},sId:this.sessionId};this.buffer.push(t),this.flushOrRecord(!1)}updateAdditionalMetadata(t){this.additionalMetadata={...this.additionalMetadata,...t},this.queueOrSendUpdate("additional")}addUpdateAdditionalMetadataEvent(){const t={c:this.context,type:"update_additional_metadata",userId:this.userId,t:Date.now(),prop:{},meta:{...this.meta},additionalMetadata:{...this.additionalMetadata},sId:this.sessionId};this.buffer.push(t),this.flushOrRecord(!1)}updateMetadata(t){this.updateAdditionalMetadata(t)}flushOrRecord(t=!1){(t||this.buffer.length>=this.maxThreshold)&&this.flush()}track(e,a){this.updateSessionActivity();const i={c:this.context,type:"track",userId:this.userId,t:Date.now(),prop:{sg:t.location.pathname||"unknown",eID:a.id,eA:a.action,eT:a.type,eV:a.value||""},meta:Object.keys(this.meta).length>0?{...this.meta}:{},additionalMetadata:{...this.additionalMetadata},sId:this.sessionId};a.metadata&&(i.additionalMetadata={...i.additionalMetadata,...a.metadata}),this.buffer.push(i),this.buffer.length>=this.maxThreshold&&this.flush()}enrichWithGeolocation(){return fetch("https://ipapi.co/json/").then((t=>t.json())).then((t=>({location:t.country_name||""}))).catch((t=>(console.warn("MoveoOne: Failed to enrich geolocation",t),{location:""})))}async start(){if(this.isPageNavigation)return await this.trackPageNavigation(),this.started=!0,void this.processPendingUpdates();const e={c:this.context,type:"start_session",userId:this.userId,t:Date.now(),prop:{},meta:{...this.meta},additionalMetadata:{...this.additionalMetadata},sId:this.sessionId},a=new URLSearchParams(t.location.search),i={utm_source:a.get("utm_source")||"",utm_medium:a.get("utm_medium")||"",utm_campaign:a.get("utm_campaign")||"",utm_term:a.get("utm_term")||"",utm_content:a.get("utm_content")||""},n="true"===localStorage.getItem("moveo-returning");n||localStorage.setItem("moveo-returning","true");const o={userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language||navigator.userLanguage,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,referrer:document.referrer||"",returningVisitor:n},s={screenWidth:t.screen.width,screenHeight:t.screen.height,screenColorDepth:t.screen.colorDepth,viewportWidth:t.innerWidth,viewportHeight:t.innerHeight,devicePixelRatio:t.devicePixelRatio||1},r=await this.enrichWithGeolocation();e.additionalMetadata={...e.additionalMetadata,...i,...o,...s,...r,url:t.location.href,title:document.title},this.additionalMetadata={...this.additionalMetadata,...e.additionalMetadata},this.buffer.push(e),this.started=!0,this.processPendingUpdates(),this.flush(),this.track("page_view",{semanticGroup:t.location.pathname||"unknown",id:t.location.pathname,type:"page",action:"view",value:document.title})}async trackPageNavigation(){this.track("page_view",{semanticGroup:t.location.pathname||"unknown",id:t.location.pathname,type:"page",action:"view",value:document.title})}setupPageUnloadTracking(){t.addEventListener("beforeunload",(()=>{if(this.buffer.length>0)if(navigator.sendBeacon){const t=JSON.stringify({events:[...this.buffer]});navigator.sendBeacon(e,t)}else this.flush();this.updateSessionActivity()})),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&(this.updateSessionActivity(),this.buffer.length>0&&this.flush())}))}flush(){if(0===this.buffer.length)return;const t=[...this.buffer];this.buffer=[],console.log("MoveoOne: Sending events",t),t.forEach(((t,e)=>{console.log(`Event ${e}:`,{type:t.type,context:t.c,sessionId:t.sId,meta:t.meta,additionalMetadata:t.additionalMetadata})})),fetch(e,{method:"POST",headers:{Authorization:this.token,"Content-Type":"application/json"},body:JSON.stringify({events:t})}).catch((t=>console.error("MoveoOne Error:",t)))}setupClickTracking(){document.addEventListener("click",(e=>{let a=e.target,i=a.tagName.toLowerCase();if(!["a","button","input","select"].includes(i)){if(a=a.closest('a, button, input[type="button"], input[type="submit"], select'),!a)return;i=a.tagName.toLowerCase()}const n={semanticGroup:t.location.pathname,id:a.id||a.name||a.href||"unnamed_element",type:i,action:"click",value:a.textContent?.trim()||a.value||"",metadata:{path:this.getElementPath(a),href:a.href||"",className:a.className||"",coordinates:`${e.clientX},${e.clientY}`}};this.track("click",n)}))}setupOutboundAndDownloadTracking(){const e=t.location.hostname,a=/\.(pdf|zip|docx?|xlsx?|pptx?|txt|csv|json|xml|rar|7z|tar|gz|exe|dmg|pkg|deb|rpm|mp3|mp4|avi|mov|wmv|flv|webm|ogg|wav|flac|jpg|jpeg|png|gif|svg|webp|bmp|tiff?|ico|psd|ai|eps|sketch)$/i;document.addEventListener("click",(i=>{const n=i.target.closest("a[href]");if(n&&n.href)try{const i=new URL(n.href,t.location.origin),o=i.hostname,s=i.pathname.split("/").pop()||"",r=a.test(s),d=o!==e&&i.protocol.startsWith("http");r?this.track("download",{semanticGroup:t.location.pathname,id:s,type:"download",action:"click",value:n.textContent?.trim()||s}):d&&this.track("outbound_link",{semanticGroup:t.location.pathname,id:o,type:"outbound_link",action:"click",value:n.textContent?.trim()||n.href})}catch(t){console.warn("MoveoOne: Invalid URL in link tracking:",n.href,t)}}))}setupScrollTracking(){let e,a=0;t.addEventListener("scroll",(()=>{clearTimeout(e),e=setTimeout((()=>{const e=t.scrollY,i=document.documentElement.scrollHeight-t.innerHeight,n=Math.round(e/i*100);Math.abs(e-a)>100&&(this.track("scroll",{semanticGroup:t.location.pathname,id:"page_scroll",type:"scroll",action:"scroll",value:n.toString(),metadata:{position:e,percentage:n,documentHeight:i+t.innerHeight}}),a=e)}),500)}))}setupFormTracking(){document.addEventListener("submit",(e=>{const a=e.target;this.track("form_submit",{semanticGroup:t.location.pathname,id:a.id||a.name||"unnamed_form",type:"form",action:"submit",value:"",metadata:{path:this.getElementPath(a),method:a.method||"get",action:a.action||""}})})),document.addEventListener("change",(e=>{const a=e.target;["select","input","textarea"].includes(a.tagName.toLowerCase())&&this.track("form_change",{semanticGroup:t.location.pathname,id:a.id||a.name||"unnamed_input",type:a.type||a.tagName.toLowerCase(),action:"change",value:"password"===a.type?"[REDACTED]":a.value,metadata:{path:this.getElementPath(a),fieldType:a.type||a.tagName.toLowerCase()}})}))}setupResizeTracking(){let e;t.addEventListener("resize",(()=>{clearTimeout(e),e=setTimeout((()=>{const e={width:t.innerWidth,height:t.innerHeight};(Math.abs(e.width-this.currentViewport.width)>50||Math.abs(e.height-this.currentViewport.height)>50)&&(this.track("viewport_resize",{semanticGroup:t.location.pathname,id:"viewport_change",type:"resize",action:"resize",value:`${e.width}x${e.height}`,metadata:{oldSize:`${this.currentViewport.width}x${this.currentViewport.height}`,newSize:`${e.width}x${e.height}`,widthChange:e.width-this.currentViewport.width,heightChange:e.height-this.currentViewport.height}}),this.currentViewport=e)}),300)}))}getElementPath(t){const e=[];for(;t&&t.nodeType===Node.ELEMENT_NODE;){let a=t.nodeName.toLowerCase();t.id?a+="#"+t.id:t.className&&(a+="."+t.className.replace(/\s+/g,".")),e.unshift(a),t=t.parentNode}return e.join(" > ")}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}}t.MoveoOne={init:function(e,i={}){const n=new a(e),o=["locale","test","softwareVersion"];return Object.keys(i).forEach((t=>{if(o.includes(t))switch(t){case"locale":"string"==typeof i[t]&&(n.meta.locale=i[t]);break;case"test":"string"==typeof i[t]&&(n.meta.test=i[t]);break;case"softwareVersion":"string"==typeof i[t]&&(n.meta.softwareVersion=i[t])}else console.warn(`MoveoOne: Invalid meta field "${t}" ignored. Allowed fields: ${o.join(", ")}`)})),n.initialize(),t.MoveoOne.instance=n,n}}}(window);