!function(t){if(t.MoveoOne)return;const e="https://dev-api.moveo.one/api/analytic/event/tag";class i{constructor(e){this.token=e,this.userId="",this.buffer=[],this.flushInterval=5e3,this.maxThreshold=100,this.context="WEB_STATIC",this.sessionId=this.getOrCreateSessionId(),this.started=!1,this.pendingUpdates=[],this.meta={},this.additionalMeta={},this.currentViewport={width:t.innerWidth,height:t.innerHeight},this.isPageNavigation=this.checkIfPageNavigation(),this.impressionObserver=null,this.seenElements=new WeakSet,setInterval((()=>this.flush()),this.flushInterval)}getOrCreateSessionId(){const t="moveo-session-id",e="moveo-session-timestamp",i=localStorage.getItem(t),n=localStorage.getItem(e);if(i&&n){const t=Date.now();if(t-parseInt(n,10)<18e5)return localStorage.setItem(e,t.toString()),this.isExistingSession=!0,i}this.isExistingSession=!1;const a=this.generateUUID();return localStorage.setItem(t,a),localStorage.setItem(e,Date.now().toString()),a}checkIfPageNavigation(){const e="moveo-last-path",i=localStorage.getItem(e),n=t.location.pathname;return localStorage.setItem(e,n),i&&i!==n}updateSessionActivity(){localStorage.setItem("moveo-session-timestamp",Date.now().toString())}initialize(){this.start(),this.setupClickTracking(),this.setupDownloadOrOutboundLinkTracking(),this.setupScrollTracking(),this.setupFormTracking(),this.setupHoverTracking(),this.setupResizeTracking(),this.setupPageUnloadTracking(),this.setupMediaTracking(),this.setupClipboardTracking()}identify(t){this.userId=t}setLocale(t){this.meta.locale=t,this.queueOrSendUpdate("meta")}setTest(t){this.meta.test=t,this.queueOrSendUpdate("meta")}setSoftwareVersion(t){this.meta.softwareVersion=t,this.queueOrSendUpdate("meta")}queueOrSendUpdate(t){this.started?"meta"===t?this.addUpdateMetadataEvent():"additional"===t&&this.addUpdateAdditionalMetadataEvent():this.pendingUpdates.push(t)}processPendingUpdates(){[...new Set(this.pendingUpdates)].forEach((t=>{"meta"===t?this.addUpdateMetadataEvent():"additional"===t&&this.addUpdateAdditionalMetadataEvent()})),this.pendingUpdates=[]}addUpdateMetadataEvent(){const t={c:this.context,type:"update_metadata",userId:this.userId,t:Date.now(),prop:{},meta:{...this.meta},additionalMeta:{...this.additionalMeta},sId:this.sessionId};this.buffer.push(t),this.flushOrRecord(!1)}updateAdditionalMetadata(t){this.additionalMeta={...this.additionalMeta,...t},this.queueOrSendUpdate("additional")}addUpdateAdditionalMetadataEvent(){const t={c:this.context,type:"update_additional_metadata",userId:this.userId,t:Date.now(),prop:{},meta:{...this.meta},additionalMeta:{...this.additionalMeta},sId:this.sessionId};this.buffer.push(t),this.flushOrRecord(!1)}updateMetadata(t){this.updateAdditionalMetadata(t)}flushOrRecord(t=!1){(t||this.buffer.length>=this.maxThreshold)&&this.flush()}track(e,i){this.updateSessionActivity();const n={c:this.context,type:"track",userId:this.userId,t:Date.now(),prop:{sg:t.location.pathname||"unknown",eID:i.id,eA:i.action,eT:i.type,eV:i.value||""},sId:this.sessionId};this.buffer.push(n),this.buffer.length>=this.maxThreshold&&this.flush()}trackImmediate(e,i){this.updateSessionActivity();const n={c:this.context,type:"track",userId:this.userId,t:Date.now(),prop:{sg:t.location.pathname||"unknown",eID:i.id,eA:i.action,eT:i.type,eV:i.value||""},sId:this.sessionId};i.metadata&&(n.additionalMeta={...n.additionalMeta,...i.metadata}),this.sendEventImmediate(n)}sendEventImmediate(t){const i=JSON.stringify({events:[t]});fetch(e,{method:"POST",headers:{Authorization:this.token,"Content-Type":"application/json"},body:i,keepalive:!0}).catch((t=>console.error("MoveoOne Immediate Error:",t)))}enrichWithGeolocation(){return fetch("https://ipapi.co/json/").then((t=>t.json())).then((t=>({location:t.country_name||""}))).catch((t=>(console.warn("MoveoOne: Failed to enrich geolocation",t),{location:""})))}async start(){if(this.isPageNavigation)return await this.trackPageNavigation(),this.started=!0,this.processPendingUpdates(),void this.initImpressionObserver();if(this.isExistingSession)return this.started=!0,this.processPendingUpdates(),this.track("page_view",{semanticGroup:t.location.pathname||"unknown",id:t.location.pathname,type:"page",action:"view",value:document.title}),this.track("viewport_size",{semanticGroup:t.location.pathname||"unknown",id:t.location.pathname,type:"viewport",action:"size",value:`${this.currentViewport.width}x${this.currentViewport.height}`}),void setTimeout((()=>{this.initImpressionObserver()}),100);const e={c:this.context,type:"start_session",userId:this.userId,t:Date.now(),prop:{},meta:{...this.meta},additionalMeta:{...this.additionalMeta},sId:this.sessionId},i=new URLSearchParams(t.location.search),n={utm_source:i.get("utm_source")||"",utm_medium:i.get("utm_medium")||"",utm_campaign:i.get("utm_campaign")||"",utm_term:i.get("utm_term")||"",utm_content:i.get("utm_content")||""},a="true"===localStorage.getItem("moveo-returning");a||localStorage.setItem("moveo-returning","true");const o={userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language||navigator.userLanguage,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,referrer:document.referrer||"",returningVisitor:a},s={screenWidth:t.screen.width,screenHeight:t.screen.height,screenColorDepth:t.screen.colorDepth,devicePixelRatio:t.devicePixelRatio||1},r=await this.enrichWithGeolocation();e.additionalMeta={...e.additionalMeta,...n,...o,...s,...r,title:document.title},this.additionalMeta={...this.additionalMeta,...e.additionalMeta},this.buffer.push(e),this.started=!0,this.processPendingUpdates(),this.flush(),this.track("page_view",{semanticGroup:t.location.pathname||"unknown",id:t.location.pathname,type:"page",action:"view",value:document.title}),this.track("viewport_size",{semanticGroup:t.location.pathname||"unknown",id:t.location.pathname,type:"viewport",action:"size",value:`${this.currentViewport.width}x${this.currentViewport.height}`}),setTimeout((()=>{this.initImpressionObserver()}),100)}initImpressionObserver(){if(!this.started)return;const t=["img[src]","video",'iframe[src*="youtube"], iframe[src*="vimeo"]','a[href]:not([href="#"])','button, input[type=button i], input[type=submit i], [role="button"]',"h1, h2, h3"],e=(()=>{let t;return e=>{cancelAnimationFrame(t),t=requestAnimationFrame(e)}})();this.impressionObserver=new IntersectionObserver((t=>{e((()=>{t.forEach((t=>{t.isIntersecting&&!this.seenElements.has(t.target)?(this.seenElements.add(t.target),this.sendAutoImpression(t.target,t.boundingClientRect,"appear")):!t.isIntersecting&&this.seenElements.has(t.target)&&(this.seenElements.delete(t.target),this.sendAutoImpression(t.target,t.boundingClientRect,"disappear"))}))}))}),{root:null,threshold:.2});const i=e=>{if(!e||1!==e.nodeType)return;if(e.dataset&&e.dataset.moveoObserved)return;(e.matches&&e.matches(t.join(","))||(t=>!!t.childNodes.length&&[...t.childNodes].some((t=>3===t.nodeType&&t.textContent.trim().length>=35)))(e))&&(this.impressionObserver.observe(e),e.dataset.moveoObserved="true")},n=()=>{document.querySelectorAll("*").forEach(i)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n();new MutationObserver((t=>{t.forEach((t=>{t.addedNodes.forEach((t=>{1===t.nodeType&&(i(t),t.querySelectorAll&&t.querySelectorAll("*").forEach(i))}))}))})).observe(document.documentElement,{childList:!0,subtree:!0})}sendAutoImpression(e,i,n){let a="";a=e.matches("img")?e.alt||e.title||this.getFilenameFromUrl(e.currentSrc||e.src)||"image":e.matches("video")?e.title||this.getFilenameFromUrl(e.currentSrc||e.src)||"video":e.matches("iframe")?e.title||this.getFilenameFromUrl(e.src)||"embedded_content":e.matches("a")?(e.innerText||e.textContent||"").trim()||e.href||"link":e.matches('button,input,[role="button"]')?(e.innerText||e.value||e.getAttribute("aria-label")||"").trim()||"button":e.matches("h1,h2,h3")?(e.innerText||e.textContent||"").trim()||"heading":(e.innerText||e.textContent||"").trim()||"text",a.length>100&&(a=a.substring(0,97)+"...");const o={semanticGroup:t.location.pathname||"unknown",id:e.id||e.className||`${e.tagName.toLowerCase()}_${Date.now()}`,type:e.tagName.toLowerCase(),action:n,value:a};this.track("impression",o)}getFilenameFromUrl(t){if(!t)return"";try{const e=new URL(t).pathname;return e.split("/").pop()||""}catch(e){const i=t.split("/");return i[i.length-1]||""}}cleanUrl(t){if(!t)return"";try{const e=new URL(t);return e.origin+e.pathname}catch(e){return t}}getElementText(t){if("INPUT"===t.tagName)return t.value||t.placeholder||t.type;if("SELECT"===t.tagName){const e=t.selectedOptions[0];return e?e.textContent.trim():t.name||"select"}if("TEXTAREA"===t.tagName)return t.value||t.placeholder||"textarea";if("IMG"===t.tagName)return t.alt||t.title||"image";let e="";for(let i of t.childNodes)i.nodeType===Node.TEXT_NODE&&(e+=i.textContent);return!e.trim()&&t.textContent&&(e=t.textContent.trim()),e=e.trim().replace(/\s+/g," "),e.length>100?e.substring(0,97)+"...":e}shouldTrackElement(t){const e=t.getBoundingClientRect();if(0===e.width||0===e.height)return!1;if(["SCRIPT","STYLE","NOSCRIPT","META","LINK","HEAD","TITLE"].includes(t.tagName))return!1;const i=this.getElementText(t);return!(!i||i.length<2)&&((!t.id||!t.id.includes("moveo"))&&(!t.className||!t.className.includes("moveo")))}setupHoverTracking(){let e;document.addEventListener("mouseover",(i=>{const n=i.target;clearTimeout(e),this.shouldTrackElement(n)&&(e=setTimeout((()=>{const e=this.getElementText(n),i={semanticGroup:t.location.pathname,id:n.id||n.className||n.tagName.toLowerCase()||"unnamed_element",type:n.tagName.toLowerCase(),action:"hover",value:e};this.track("hover",i)}),1500))})),document.addEventListener("mouseout",(t=>{clearTimeout(e)}))}async trackPageNavigation(){const e={c:this.context,type:"track",userId:this.userId,t:Date.now(),prop:{sg:t.location.pathname||"unknown",eID:t.location.pathname,eA:"view",eT:"page",eV:document.title||""},meta:Object.keys(this.meta).length>0?{...this.meta}:{},additionalMeta:{...this.additionalMeta},sId:this.sessionId};this.sendEventImmediate(e)}isOutboundLink(e){try{const i=new URL(e,t.location.href),n=t.location.hostname;return i.hostname!==n&&i.protocol.startsWith("http")}catch(t){return!1}}setupDownloadOrOutboundLinkTracking(){const e=()=>{document.querySelectorAll("a[href]").forEach((e=>{if(e.dataset.moveoLinkTracked)return;const i=e.href,n=i.match(/\.(pdf|zip|docx?|xlsx?|pptx?|txt|csv|json|xml|gz|tar|rar|7z|exe|dmg|pkg|deb|rpm|iso|img|mp3|mp4|avi|mov|wmv|flv|webm|ogg|wav|flac)$/i),a=this.isOutboundLink(i);(n||a)&&(e.dataset.moveoLinkTracked="true",e.addEventListener("click",(e=>{if(n){const e=i.split("/").pop()||i;e.split(".").pop();this.trackImmediate("download",{semanticGroup:t.location.pathname,id:e,type:"download",action:"click",value:e}),console.log("MoveoOne: Download tracked -",e)}else if(a){const e=new URL(i).hostname;this.trackImmediate("outbound_link",{semanticGroup:t.location.pathname,id:e,type:"outbound_link",action:"click",value:i}),console.log("MoveoOne: Outbound link tracked -",e)}})))}))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e();const i=()=>{const t=document.body||document.documentElement;if(t){new MutationObserver((()=>{e()})).observe(t,{childList:!0,subtree:!0})}};document.body?i():document.addEventListener("DOMContentLoaded",i)}setupPageUnloadTracking(){t.addEventListener("beforeunload",(()=>{if(this.buffer.length>0){const t=JSON.stringify({events:[...this.buffer]});fetch(e,{method:"POST",headers:{Authorization:this.token,"Content-Type":"application/json"},body:t,keepalive:!0}).catch((t=>console.error("MoveoOne Unload Error:",t)))}this.updateSessionActivity()})),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&(this.updateSessionActivity(),this.buffer.length>0&&this.flush())}))}setupMediaTracking(){const e=()=>{document.querySelectorAll("video, audio").forEach((e=>{if(e.dataset.moveoTracked)return;e.dataset.moveoTracked="true";const i=e.tagName.toLowerCase(),n=e.id||e.currentSrc||e.src||"unnamed_media";e.addEventListener("play",(()=>{this.track("media_play",{semanticGroup:t.location.pathname,id:n,type:i,action:"play"})})),e.addEventListener("pause",(()=>{this.track("media_pause",{semanticGroup:t.location.pathname,id:n,type:i,action:"pause"})})),e.addEventListener("ended",(()=>{this.track("media_complete",{semanticGroup:t.location.pathname,id:n,type:i,action:"complete"})}))}))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e();const i=()=>{const t=document.body||document.documentElement;if(t){new MutationObserver((()=>{e()})).observe(t,{childList:!0,subtree:!0})}};document.body?i():document.addEventListener("DOMContentLoaded",i)}setupClipboardTracking(){document.addEventListener("copy",(e=>{const i=t.getSelection().toString();i&&i.trim().length>0&&this.track("copy",{semanticGroup:t.location.pathname,id:"copy_text",type:"clipboard",action:"copy",value:i.length>100?i.slice(0,100)+"…":i})}))}flush(){if(0===this.buffer.length)return;const t=[...this.buffer];this.buffer=[],console.log("MoveoOne: Sending events",t),t.forEach(((t,e)=>{console.log(`Event ${e}:`,{type:t.type,context:t.c,sessionId:t.sId,eA:t.prop.eA,eT:t.prop.eT,eV:t.prop.eV,meta:t.meta,additionalMeta:t.additionalMeta})})),fetch(e,{method:"POST",headers:{Authorization:this.token,"Content-Type":"application/json"},body:JSON.stringify({events:t})}).catch((t=>console.error("MoveoOne Error:",t)))}setupClickTracking(){document.addEventListener("click",(e=>{let i=e.target;if(!this.shouldTrackElement(i))return;if("A"===i.tagName&&i.href){const t=i.href.match(/\.(pdf|zip|docx?|xlsx?|pptx?|txt|csv|json|xml|gz|tar|rar|7z|exe|dmg|pkg|deb|rpm|iso|img|mp3|mp4|avi|mov|wmv|flv|webm|ogg|wav|flac)$/i),e=this.isOutboundLink(i.href);if(t||e)return}const n=this.getElementText(i),a={semanticGroup:t.location.pathname,id:i.id||i.className||i.tagName.toLowerCase()||"unnamed_element",type:i.tagName.toLowerCase(),action:"click",value:n};this.track("click",a)}))}setupScrollTracking(){let e,i=0;t.addEventListener("scroll",(()=>{clearTimeout(e),e=setTimeout((()=>{const e=t.scrollY,n=document.documentElement.scrollHeight-t.innerHeight,a=Math.round(e/n*100);Math.abs(e-i)>100&&(this.track("scroll",{semanticGroup:t.location.pathname,id:"page_scroll",type:"scroll",action:"scroll",value:a.toString()}),i=e)}),500)}))}setupFormTracking(){document.addEventListener("submit",(e=>{const i=e.target;this.track("form_submit",{semanticGroup:t.location.pathname,id:i.id||i.name||"unnamed_form",type:"form",action:"submit",value:""})})),document.addEventListener("change",(e=>{const i=e.target;["select","input","textarea"].includes(i.tagName.toLowerCase())&&this.track("form_change",{semanticGroup:t.location.pathname,id:i.id||i.name||"unnamed_input",type:i.type||i.tagName.toLowerCase(),action:"change",value:"password"===i.type?"[REDACTED]":i.value})}))}setupResizeTracking(){let e;t.addEventListener("resize",(()=>{clearTimeout(e),e=setTimeout((()=>{const e={width:t.innerWidth,height:t.innerHeight};(Math.abs(e.width-this.currentViewport.width)>50||Math.abs(e.height-this.currentViewport.height)>50)&&(this.track("viewport_resize",{semanticGroup:t.location.pathname,id:"viewport_change",type:"resize",action:"resize",value:`${e.width}x${e.height}`}),this.currentViewport=e)}),300)}))}getElementPath(t){const e=[];for(;t&&t.nodeType===Node.ELEMENT_NODE;){let i=t.nodeName.toLowerCase();t.id?i+="#"+t.id:t.className&&(i+="."+t.className.replace(/\s+/g,".")),e.unshift(i),t=t.parentNode}return e.join(" > ")}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}}t.MoveoOne={init:function(e,n={}){const a=new i(e),o=["locale","test","softwareVersion"];return Object.keys(n).forEach((t=>{if(o.includes(t))switch(t){case"locale":"string"==typeof n[t]&&(a.meta.locale=n[t]);break;case"test":"string"==typeof n[t]&&(a.meta.test=n[t]);break;case"softwareVersion":"string"==typeof n[t]&&(a.meta.softwareVersion=n[t])}else console.warn(`MoveoOne: Invalid meta field "${t}" ignored. Allowed fields: ${o.join(", ")}`)})),a.initialize(),t.MoveoOne.instance=a,a}}}(window);