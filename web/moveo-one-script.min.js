!function(e){if(e.MoveoOne)return;const t="https://api.moveo.one/api/analytic/event/tag",i="1.0.1";class n{constructor(t){this.token=t,this.userId="",this.buffer=[],this.flushInterval=5e3,this.maxThreshold=100,this.context="WEB_STATIC",this.sessionId=this.getOrCreateSessionId(),this.started=!1,this.pendingUpdates=[],this.meta={libVersion:i},this.additionalMeta={},this.currentViewport={width:e.innerWidth,height:e.innerHeight},this.isPageNavigation=this.checkIfPageNavigation(),this.impressionObserver=null,this.seenElements=new WeakSet,setInterval((()=>this.flush()),this.flushInterval)}getOrCreateSessionId(){const e="moveo-session-id",t="moveo-session-timestamp",i=localStorage.getItem(e),n=localStorage.getItem(t);if(i&&n){const e=Date.now();if(e-parseInt(n,10)<18e5)return localStorage.setItem(t,e.toString()),this.isExistingSession=!0,i}this.isExistingSession=!1;const a=this.generateUUID();return localStorage.setItem(e,a),localStorage.setItem(t,Date.now().toString()),a}checkIfPageNavigation(){const t="moveo-last-path",i=localStorage.getItem(t),n=e.location.pathname;return localStorage.setItem(t,n),i&&i!==n}updateSessionActivity(){localStorage.setItem("moveo-session-timestamp",Date.now().toString())}initialize(){this.start(),this.setupClickTracking(),this.setupDownloadOrOutboundLinkTracking(),this.setupScrollTracking(),this.setupFormTracking(),this.setupHoverTracking(),this.setupResizeTracking(),this.setupPageUnloadTracking(),this.setupMediaTracking(),this.setupClipboardTracking()}identify(e){this.userId=e}setLocale(e){this.meta.locale=e,this.meta.libVersion=i,this.queueOrSendUpdate("meta")}setTest(e){this.meta.test=e,this.meta.libVersion=i,this.queueOrSendUpdate("meta")}setSoftwareVersion(e){this.meta.softwareVersion=e,this.meta.libVersion=i,this.queueOrSendUpdate("meta")}queueOrSendUpdate(e){this.started?"meta"===e?this.addUpdateMetadataEvent():"additional"===e&&this.addUpdateAdditionalMetadataEvent():this.pendingUpdates.push(e)}processPendingUpdates(){[...new Set(this.pendingUpdates)].forEach((e=>{"meta"===e?this.addUpdateMetadataEvent():"additional"===e&&this.addUpdateAdditionalMetadataEvent()})),this.pendingUpdates=[]}addUpdateMetadataEvent(){const e={...this.meta,libVersion:i},t={c:this.context,type:"update_metadata",userId:this.userId,t:Date.now(),prop:{},meta:e,additionalMeta:{...this.additionalMeta},sId:this.sessionId};this.buffer.push(t),this.flushOrRecord(!1)}updateAdditionalMetadata(e){this.additionalMeta={...this.additionalMeta,...e},this.queueOrSendUpdate("additional")}addUpdateAdditionalMetadataEvent(){const e={...this.meta,libVersion:i},t={c:this.context,type:"update_additional_metadata",userId:this.userId,t:Date.now(),prop:{},meta:e,additionalMeta:{...this.additionalMeta},sId:this.sessionId};this.buffer.push(t),this.flushOrRecord(!1)}updateMetadata(e){this.updateAdditionalMetadata(e)}flushOrRecord(e=!1){(e||this.buffer.length>=this.maxThreshold)&&this.flush()}track(t,i){this.updateSessionActivity();const n={c:this.context,type:"track",userId:this.userId,t:Date.now(),prop:{sg:e.location.pathname||"unknown",eID:i.id,eA:i.action,eT:i.type,eV:i.value||""},sId:this.sessionId};this.buffer.push(n),this.buffer.length>=this.maxThreshold&&this.flush()}trackImmediate(t,i){this.updateSessionActivity();const n={c:this.context,type:"track",userId:this.userId,t:Date.now(),prop:{sg:e.location.pathname||"unknown",eID:i.id,eA:i.action,eT:i.type,eV:i.value||""},sId:this.sessionId};i.metadata&&(n.additionalMeta={...n.additionalMeta,...i.metadata}),this.sendEventImmediate(n)}sendEventImmediate(e){const i=JSON.stringify({events:[e]});fetch(t,{method:"POST",headers:{Authorization:this.token,"Content-Type":"application/json"},body:i,keepalive:!0}).catch((e=>console.error("MoveoOne Immediate Error:",e)))}enrichWithGeolocation(){return fetch("https://ipapi.co/json/").then((e=>e.json())).then((e=>({location:e.country_name||""}))).catch((e=>(console.warn("MoveoOne: Failed to enrich geolocation",e),{location:""})))}async start(){if(this.isPageNavigation)return await this.trackPageNavigation(),this.started=!0,this.processPendingUpdates(),void this.initImpressionObserver();if(this.isExistingSession)return this.started=!0,this.processPendingUpdates(),this.track("page_view",{semanticGroup:e.location.pathname||"unknown",id:e.location.pathname,type:"page",action:"view",value:document.title}),this.track("viewport_size",{semanticGroup:e.location.pathname||"unknown",id:e.location.pathname,type:"viewport",action:"size",value:`${this.currentViewport.width}x${this.currentViewport.height}`}),void setTimeout((()=>{this.initImpressionObserver()}),100);const t={...this.meta,libVersion:i},n={c:this.context,type:"start_session",userId:this.userId,t:Date.now(),prop:{},meta:t,additionalMeta:{...this.additionalMeta},sId:this.sessionId},a=new URLSearchParams(e.location.search),o={utm_source:a.get("utm_source")||"",utm_medium:a.get("utm_medium")||"",utm_campaign:a.get("utm_campaign")||"",utm_term:a.get("utm_term")||"",utm_content:a.get("utm_content")||""},s="true"===localStorage.getItem("moveo-returning");s||localStorage.setItem("moveo-returning","true");const r={userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language||navigator.userLanguage,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,referrer:document.referrer||"",returningVisitor:s},d={screenWidth:e.screen.width,screenHeight:e.screen.height,screenColorDepth:e.screen.colorDepth,devicePixelRatio:e.devicePixelRatio||1},c=await this.enrichWithGeolocation();n.additionalMeta={...n.additionalMeta,...o,...r,...d,...c,title:document.title},this.additionalMeta={...this.additionalMeta,...n.additionalMeta},this.buffer.push(n),this.started=!0,this.processPendingUpdates(),this.flush(),this.track("page_view",{semanticGroup:e.location.pathname||"unknown",id:e.location.pathname,type:"page",action:"view",value:document.title}),this.track("viewport_size",{semanticGroup:e.location.pathname||"unknown",id:e.location.pathname,type:"viewport",action:"size",value:`${this.currentViewport.width}x${this.currentViewport.height}`}),setTimeout((()=>{this.initImpressionObserver()}),100)}initImpressionObserver(){if(!this.started)return;const t=["img[src]","video",'iframe[src*="youtube"], iframe[src*="vimeo"]','a[href]:not([href="#"])','button, input[type=button i], input[type=submit i], [role="button"]',"h1, h2, h3"],i=new Map,n=(()=>{let e;return t=>{cancelAnimationFrame(e),e=requestAnimationFrame(t)}})();this.impressionObserver=new IntersectionObserver((e=>{n((()=>{e.forEach((e=>{if(e.isIntersecting&&!this.seenElements.has(e.target)){const t=setTimeout((()=>{this.seenElements.has(e.target)&&this.sendAutoImpression(e.target,e.boundingClientRect,"appear"),i.delete(e.target)}),1e3);i.set(e.target,t),this.seenElements.add(e.target)}else if(!e.isIntersecting&&this.seenElements.has(e.target)){const t=i.get(e.target);t?(clearTimeout(t),i.delete(e.target)):this.sendAutoImpression(e.target,e.boundingClientRect,"disappear"),this.seenElements.delete(e.target)}}))}))}),{root:null,threshold:.2});const a=e=>{if(!e||1!==e.nodeType)return;if(e.dataset&&e.dataset.moveoObserved)return;(e.matches&&e.matches(t.join(","))||(e=>!!e.childNodes.length&&[...e.childNodes].some((e=>3===e.nodeType&&e.textContent.trim().length>=15)))(e))&&(this.impressionObserver.observe(e),e.dataset.moveoObserved="true")},o=()=>{document.querySelectorAll("*").forEach(a)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",o):o();new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{1===e.nodeType&&(a(e),e.querySelectorAll&&e.querySelectorAll("*").forEach(a))}))}))})).observe(document.documentElement,{childList:!0,subtree:!0}),e.addEventListener("beforeunload",(()=>{i.forEach((e=>{clearTimeout(e)})),i.clear()}))}sendAutoImpression(t,i,n){let a="";a=t.matches("img")?t.alt||t.title||this.getFilenameFromUrl(t.currentSrc||t.src)||"image":t.matches("video")?t.title||this.getFilenameFromUrl(t.currentSrc||t.src)||"video":t.matches("iframe")?t.title||this.getFilenameFromUrl(t.src)||"embedded_content":t.matches("a")?(t.innerText||t.textContent||"").trim()||t.href||"link":t.matches('button,input,[role="button"]')?(t.innerText||t.value||t.getAttribute("aria-label")||"").trim()||"button":t.matches("h1,h2,h3")?(t.innerText||t.textContent||"").trim()||"heading":(t.innerText||t.textContent||"").trim()||"text",a.length>100&&(a=a.substring(0,97)+"...");const o={semanticGroup:e.location.pathname||"unknown",id:t.id||t.className||`${t.tagName.toLowerCase()}_${Date.now()}`,type:t.tagName.toLowerCase(),action:n,value:a};this.track("impression",o)}getFilenameFromUrl(e){if(!e)return"";try{const t=new URL(e).pathname;return t.split("/").pop()||""}catch(t){const i=e.split("/");return i[i.length-1]||""}}cleanUrl(e){if(!e)return"";try{const t=new URL(e);return t.origin+t.pathname}catch(t){return e}}getElementText(e){if("INPUT"===e.tagName)return e.value||e.placeholder||e.type;if("SELECT"===e.tagName){const t=e.selectedOptions[0];return t?t.textContent.trim():e.name||"select"}if("TEXTAREA"===e.tagName)return e.value||e.placeholder||"textarea";if("IMG"===e.tagName)return e.alt||e.title||"image";let t="";for(let i of e.childNodes)i.nodeType===Node.TEXT_NODE&&(t+=i.textContent);return!t.trim()&&e.textContent&&(t=e.textContent.trim()),t=t.trim().replace(/\s+/g," "),t.length>100?t.substring(0,97)+"...":t}shouldTrackElement(e){const t=e.getBoundingClientRect();if(0===t.width||0===t.height)return!1;if(["SCRIPT","STYLE","NOSCRIPT","META","LINK","HEAD","TITLE"].includes(e.tagName))return!1;const i=this.getElementText(e);return!(!i||i.length<2)&&((!e.id||!e.id.includes("moveo"))&&(!e.className||!e.className.includes("moveo")))}setupHoverTracking(){let t;document.addEventListener("mouseover",(i=>{const n=i.target;clearTimeout(t),this.shouldTrackElement(n)&&(t=setTimeout((()=>{const t=this.getElementText(n),i={semanticGroup:e.location.pathname,id:n.id||n.className||n.tagName.toLowerCase()||"unnamed_element",type:n.tagName.toLowerCase(),action:"hover",value:t};this.track("hover",i)}),1500))})),document.addEventListener("mouseout",(e=>{clearTimeout(t)}))}async trackPageNavigation(){const t={c:this.context,type:"track",userId:this.userId,t:Date.now(),prop:{sg:e.location.pathname||"unknown",eID:e.location.pathname,eA:"view",eT:"page",eV:document.title||""},sId:this.sessionId};this.sendEventImmediate(t)}isOutboundLink(t){try{const i=new URL(t,e.location.href),n=e.location.hostname;return i.hostname!==n&&i.protocol.startsWith("http")}catch(e){return!1}}setupDownloadOrOutboundLinkTracking(){const t=()=>{document.querySelectorAll("a[href]").forEach((t=>{if(t.dataset.moveoLinkTracked)return;const i=t.href,n=i.match(/\.(pdf|zip|docx?|xlsx?|pptx?|txt|csv|json|xml|gz|tar|rar|7z|exe|dmg|pkg|deb|rpm|iso|img|mp3|mp4|avi|mov|wmv|flv|webm|ogg|wav|flac)$/i),a=this.isOutboundLink(i);(n||a)&&(t.dataset.moveoLinkTracked="true",t.addEventListener("click",(t=>{if(n){const t=i.split("/").pop()||i;t.split(".").pop();this.trackImmediate("download",{semanticGroup:e.location.pathname,id:t,type:"download",action:"click",value:t}),console.log("MoveoOne: Download tracked -",t)}else if(a){const t=new URL(i).hostname;this.trackImmediate("outbound_link",{semanticGroup:e.location.pathname,id:t,type:"outbound_link",action:"click",value:i}),console.log("MoveoOne: Outbound link tracked -",t)}})))}))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t();const i=()=>{const e=document.body||document.documentElement;if(e){new MutationObserver((()=>{t()})).observe(e,{childList:!0,subtree:!0})}};document.body?i():document.addEventListener("DOMContentLoaded",i)}setupPageUnloadTracking(){e.addEventListener("beforeunload",(()=>{if(this.buffer.length>0){const e=JSON.stringify({events:[...this.buffer]});fetch(t,{method:"POST",headers:{Authorization:this.token,"Content-Type":"application/json"},body:e,keepalive:!0}).catch((e=>console.error("MoveoOne Unload Error:",e)))}this.updateSessionActivity()})),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&(this.updateSessionActivity(),this.buffer.length>0&&this.flush())}))}setupMediaTracking(){const t=()=>{document.querySelectorAll("video, audio").forEach((t=>{if(t.dataset.moveoTracked)return;t.dataset.moveoTracked="true";const i=t.tagName.toLowerCase(),n=t.id||t.currentSrc||t.src||"unnamed_media";t.addEventListener("play",(()=>{this.track("media_play",{semanticGroup:e.location.pathname,id:n,type:i,action:"play"})})),t.addEventListener("pause",(()=>{this.track("media_pause",{semanticGroup:e.location.pathname,id:n,type:i,action:"pause"})})),t.addEventListener("ended",(()=>{this.track("media_complete",{semanticGroup:e.location.pathname,id:n,type:i,action:"complete"})}))}))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t();const i=()=>{const e=document.body||document.documentElement;if(e){new MutationObserver((()=>{t()})).observe(e,{childList:!0,subtree:!0})}};document.body?i():document.addEventListener("DOMContentLoaded",i)}setupClipboardTracking(){document.addEventListener("copy",(t=>{const i=e.getSelection().toString();i&&i.trim().length>0&&this.track("copy",{semanticGroup:e.location.pathname,id:"copy_text",type:"clipboard",action:"copy",value:i.length>100?i.slice(0,100)+"…":i})}))}flush(){if(0===this.buffer.length)return;const e=[...this.buffer];this.buffer=[],console.log("MoveoOne: Sending events",e),e.forEach(((e,t)=>{console.log(`Event ${t}:`,{type:e.type,context:e.c,sessionId:e.sId,eA:e.prop.eA,eT:e.prop.eT,eV:e.prop.eV,meta:e.meta,additionalMeta:e.additionalMeta})})),fetch(t,{method:"POST",headers:{Authorization:this.token,"Content-Type":"application/json"},body:JSON.stringify({events:e})}).catch((e=>console.error("MoveoOne Error:",e)))}setupClickTracking(){document.addEventListener("click",(t=>{let i=t.target;if(!this.shouldTrackElement(i))return;if("A"===i.tagName&&i.href){const e=i.href.match(/\.(pdf|zip|docx?|xlsx?|pptx?|txt|csv|json|xml|gz|tar|rar|7z|exe|dmg|pkg|deb|rpm|iso|img|mp3|mp4|avi|mov|wmv|flv|webm|ogg|wav|flac)$/i),t=this.isOutboundLink(i.href);if(e||t)return}const n=this.getElementText(i),a={semanticGroup:e.location.pathname,id:i.id||i.className||i.tagName.toLowerCase()||"unnamed_element",type:i.tagName.toLowerCase(),action:"click",value:n};this.track("click",a)}))}setupScrollTracking(){let t,i=0;e.addEventListener("scroll",(()=>{clearTimeout(t),t=setTimeout((()=>{const t=e.scrollY,n=document.documentElement.scrollHeight-e.innerHeight,a=Math.round(t/n*100);Math.abs(t-i)>100&&(this.track("scroll",{semanticGroup:e.location.pathname,id:"page_scroll",type:"scroll",action:"scroll",value:a.toString()}),i=t)}),500)}))}setupFormTracking(){document.addEventListener("submit",(t=>{const i=t.target;this.track("form_submit",{semanticGroup:e.location.pathname,id:i.id||i.name||"unnamed_form",type:"form",action:"submit",value:""})})),document.addEventListener("change",(t=>{const i=t.target;["select","input","textarea"].includes(i.tagName.toLowerCase())&&this.track("form_change",{semanticGroup:e.location.pathname,id:i.id||i.name||"unnamed_input",type:i.type||i.tagName.toLowerCase(),action:"change",value:"password"===i.type?"[REDACTED]":i.value})}))}setupResizeTracking(){let t;e.addEventListener("resize",(()=>{clearTimeout(t),t=setTimeout((()=>{const t={width:e.innerWidth,height:e.innerHeight};(Math.abs(t.width-this.currentViewport.width)>50||Math.abs(t.height-this.currentViewport.height)>50)&&(this.track("viewport_resize",{semanticGroup:e.location.pathname,id:"viewport_change",type:"resize",action:"resize",value:`${t.width}x${t.height}`}),this.currentViewport=t)}),300)}))}getElementPath(e){const t=[];for(;e&&e.nodeType===Node.ELEMENT_NODE;){let i=e.nodeName.toLowerCase();e.id?i+="#"+e.id:e.className&&(i+="."+e.className.replace(/\s+/g,".")),t.unshift(i),e=e.parentNode}return t.join(" > ")}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}}e.MoveoOne={init:function(t,a={}){const o=new n(t),s=["locale","test","softwareVersion"];return Object.keys(a).forEach((e=>{if(s.includes(e))switch(e){case"locale":"string"==typeof a[e]&&(o.meta.locale=a[e]);break;case"test":"string"==typeof a[e]&&(o.meta.test=a[e]);break;case"softwareVersion":"string"==typeof a[e]&&(o.meta.softwareVersion=a[e])}else"libVersion"===e?console.warn(`MoveoOne: libVersion is automatically set to "${i}" and cannot be overridden by client code.`):console.warn(`MoveoOne: Invalid meta field "${e}" ignored. Allowed fields: ${s.join(", ")}. Note: libVersion is automatically included.`)})),o.initialize(),e.MoveoOne.instance=o,o},getLibVersion:function(){return i}}}(window);