!function(t){if(t.MoveoOne)return;const e="https://api.moveo.one/api/analytic/event";class a{constructor(e){this.token=e,this.userId="",this.buffer=[],this.flushInterval=5e3,this.maxThreshold=500,this.context="WEB_STATIC",this.sessionId=this.getOrCreateSessionId(),this.started=!1,this.pendingUpdates=[],this.meta={},this.additionalMetadata={},this.currentViewport={width:t.innerWidth,height:t.innerHeight},this.isPageNavigation=this.checkIfPageNavigation(),setInterval((()=>this.flush()),this.flushInterval)}getOrCreateSessionId(){const t="moveo-session-id",e="moveo-session-timestamp",a=localStorage.getItem(t),i=localStorage.getItem(e);if(a&&i){const t=Date.now();if(t-parseInt(i,10)<18e5)return localStorage.setItem(e,t.toString()),a}const n=this.generateUUID();return localStorage.setItem(t,n),localStorage.setItem(e,Date.now().toString()),n}checkIfPageNavigation(){const e="moveo-last-path",a=localStorage.getItem(e),i=t.location.pathname;return localStorage.setItem(e,i),a&&a!==i}updateSessionActivity(){localStorage.setItem("moveo-session-timestamp",Date.now().toString())}initialize(){this.start(),this.setupClickTracking(),this.setupDownloadOrOutboundLinkTracking(),this.setupScrollTracking(),this.setupFormTracking(),this.setupHoverTracking(),this.setupResizeTracking(),this.setupPageUnloadTracking(),this.setupMediaTracking(),this.setupClipboardTracking()}identify(t){this.userId=t}setLocale(t){this.meta.locale=t,this.queueOrSendUpdate("meta")}setTest(t){this.meta.test=t,this.queueOrSendUpdate("meta")}setSoftwareVersion(t){this.meta.softwareVersion=t,this.queueOrSendUpdate("meta")}queueOrSendUpdate(t){this.started?"meta"===t?this.addUpdateMetadataEvent():"additional"===t&&this.addUpdateAdditionalMetadataEvent():this.pendingUpdates.push(t)}processPendingUpdates(){[...new Set(this.pendingUpdates)].forEach((t=>{"meta"===t?this.addUpdateMetadataEvent():"additional"===t&&this.addUpdateAdditionalMetadataEvent()})),this.pendingUpdates=[]}addUpdateMetadataEvent(){const t={c:this.context,type:"update_metadata",userId:this.userId,t:Date.now(),prop:{},meta:{...this.meta},additionalMetadata:{...this.additionalMetadata},sId:this.sessionId};this.buffer.push(t),this.flushOrRecord(!1)}updateAdditionalMetadata(t){this.additionalMetadata={...this.additionalMetadata,...t},this.queueOrSendUpdate("additional")}addUpdateAdditionalMetadataEvent(){const t={c:this.context,type:"update_additional_metadata",userId:this.userId,t:Date.now(),prop:{},meta:{...this.meta},additionalMetadata:{...this.additionalMetadata},sId:this.sessionId};this.buffer.push(t),this.flushOrRecord(!1)}updateMetadata(t){this.updateAdditionalMetadata(t)}flushOrRecord(t=!1){(t||this.buffer.length>=this.maxThreshold)&&this.flush()}track(e,a){this.updateSessionActivity();const i={c:this.context,type:"track",userId:this.userId,t:Date.now(),prop:{sg:t.location.pathname||"unknown",eID:a.id,eA:a.action,eT:a.type,eV:a.value||""},meta:Object.keys(this.meta).length>0?{...this.meta}:{},additionalMetadata:{...this.additionalMetadata},sId:this.sessionId};this.buffer.push(i),this.buffer.length>=this.maxThreshold&&this.flush()}trackImmediate(e,a){this.updateSessionActivity();const i={c:this.context,type:"track",userId:this.userId,t:Date.now(),prop:{sg:t.location.pathname||"unknown",eID:a.id,eA:a.action,eT:a.type,eV:a.value||""},meta:Object.keys(this.meta).length>0?{...this.meta}:{},additionalMetadata:{...this.additionalMetadata},sId:this.sessionId};a.metadata&&(i.additionalMetadata={...i.additionalMetadata,...a.metadata}),this.sendEventImmediate(i)}sendEventImmediate(t){const a=JSON.stringify({events:[t]});fetch(e,{method:"POST",headers:{Authorization:this.token,"Content-Type":"application/json"},body:a,keepalive:!0}).catch((t=>console.error("MoveoOne Immediate Error:",t)))}enrichWithGeolocation(){return fetch("https://ipapi.co/json/").then((t=>t.json())).then((t=>({location:t.country_name||""}))).catch((t=>(console.warn("MoveoOne: Failed to enrich geolocation",t),{location:""})))}async start(){if(this.isPageNavigation)return await this.trackPageNavigation(),this.started=!0,void this.processPendingUpdates();const e={c:this.context,type:"start_session",userId:this.userId,t:Date.now(),prop:{},meta:{...this.meta},additionalMetadata:{...this.additionalMetadata},sId:this.sessionId},a=new URLSearchParams(t.location.search),i={utm_source:a.get("utm_source")||"",utm_medium:a.get("utm_medium")||"",utm_campaign:a.get("utm_campaign")||"",utm_term:a.get("utm_term")||"",utm_content:a.get("utm_content")||""},n="true"===localStorage.getItem("moveo-returning");n||localStorage.setItem("moveo-returning","true");const o={userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language||navigator.userLanguage,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,referrer:document.referrer||"",returningVisitor:n},s={screenWidth:t.screen.width,screenHeight:t.screen.height,screenColorDepth:t.screen.colorDepth,viewportWidth:t.innerWidth,viewportHeight:t.innerHeight,devicePixelRatio:t.devicePixelRatio||1},r=await this.enrichWithGeolocation();e.additionalMetadata={...e.additionalMetadata,...i,...o,...s,...r,url:t.location.href,title:document.title},this.additionalMetadata={...this.additionalMetadata,...e.additionalMetadata},this.buffer.push(e),this.started=!0,this.processPendingUpdates(),this.flush(),this.track("page_view",{semanticGroup:t.location.pathname||"unknown",id:t.location.pathname,type:"page",action:"view",value:document.title})}getElementText(t){if("INPUT"===t.tagName)return t.value||t.placeholder||t.type;if("SELECT"===t.tagName){const e=t.selectedOptions[0];return e?e.textContent.trim():t.name||"select"}if("TEXTAREA"===t.tagName)return t.value||t.placeholder||"textarea";if("IMG"===t.tagName)return t.alt||t.title||"image";let e="";for(let a of t.childNodes)a.nodeType===Node.TEXT_NODE&&(e+=a.textContent);return!e.trim()&&t.textContent&&(e=t.textContent.trim()),e=e.trim().replace(/\s+/g," "),e.length>100?e.substring(0,97)+"...":e}shouldTrackElement(t){const e=t.getBoundingClientRect();if(0===e.width||0===e.height)return!1;if(["SCRIPT","STYLE","NOSCRIPT","META","LINK","HEAD","TITLE"].includes(t.tagName))return!1;const a=this.getElementText(t);return!(!a||a.length<2)&&((!t.id||!t.id.includes("moveo"))&&(!t.className||!t.className.includes("moveo")))}setupHoverTracking(){let e;document.addEventListener("mouseover",(a=>{const i=a.target;clearTimeout(e),this.shouldTrackElement(i)&&(e=setTimeout((()=>{const e=this.getElementText(i),a={semanticGroup:t.location.pathname,id:i.id||i.className||i.tagName.toLowerCase()||"unnamed_element",type:i.tagName.toLowerCase(),action:"hover",value:e};this.track("hover",a)}),1500))})),document.addEventListener("mouseout",(t=>{clearTimeout(e)}))}async trackPageNavigation(){const e={c:this.context,type:"track",userId:this.userId,t:Date.now(),prop:{sg:t.location.pathname||"unknown",eID:t.location.pathname,eA:"view",eT:"page",eV:document.title||""},meta:Object.keys(this.meta).length>0?{...this.meta}:{},additionalMetadata:{...this.additionalMetadata},sId:this.sessionId};this.sendEventImmediate(e)}isOutboundLink(e){try{const a=new URL(e,t.location.href),i=t.location.hostname;return a.hostname!==i&&a.protocol.startsWith("http")}catch(t){return!1}}setupDownloadOrOutboundLinkTracking(){const e=()=>{document.querySelectorAll("a[href]").forEach((e=>{if(e.dataset.moveoLinkTracked)return;const a=e.href,i=a.match(/\.(pdf|zip|docx?|xlsx?|pptx?|txt|csv|json|xml|gz|tar|rar|7z|exe|dmg|pkg|deb|rpm|iso|img|mp3|mp4|avi|mov|wmv|flv|webm|ogg|wav|flac)$/i),n=this.isOutboundLink(a);(i||n)&&(e.dataset.moveoLinkTracked="true",e.addEventListener("click",(e=>{if(i){const e=a.split("/").pop()||a;e.split(".").pop();this.trackImmediate("download",{semanticGroup:t.location.pathname,id:e,type:"download",action:"click",value:e}),console.log("MoveoOne: Download tracked -",e)}else if(n){const e=new URL(a).hostname;this.trackImmediate("outbound_link",{semanticGroup:t.location.pathname,id:e,type:"outbound_link",action:"click",value:a}),console.log("MoveoOne: Outbound link tracked -",e)}})))}))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e();const a=()=>{const t=document.body||document.documentElement;if(t){new MutationObserver((()=>{e()})).observe(t,{childList:!0,subtree:!0})}};document.body?a():document.addEventListener("DOMContentLoaded",a)}setupPageUnloadTracking(){t.addEventListener("beforeunload",(()=>{if(this.buffer.length>0){const t=JSON.stringify({events:[...this.buffer]});fetch(e,{method:"POST",headers:{Authorization:this.token,"Content-Type":"application/json"},body:t,keepalive:!0}).catch((t=>console.error("MoveoOne Unload Error:",t)))}this.updateSessionActivity()})),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&(this.updateSessionActivity(),this.buffer.length>0&&this.flush())}))}setupMediaTracking(){const e=()=>{document.querySelectorAll("video, audio").forEach((e=>{if(e.dataset.moveoTracked)return;e.dataset.moveoTracked="true";const a=e.tagName.toLowerCase(),i=e.id||e.currentSrc||e.src||"unnamed_media";e.addEventListener("play",(()=>{this.track("media_play",{semanticGroup:t.location.pathname,id:i,type:a,action:"play"})})),e.addEventListener("pause",(()=>{this.track("media_pause",{semanticGroup:t.location.pathname,id:i,type:a,action:"pause"})})),e.addEventListener("ended",(()=>{this.track("media_complete",{semanticGroup:t.location.pathname,id:i,type:a,action:"complete"})}))}))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e();const a=()=>{const t=document.body||document.documentElement;if(t){new MutationObserver((()=>{e()})).observe(t,{childList:!0,subtree:!0})}};document.body?a():document.addEventListener("DOMContentLoaded",a)}setupClipboardTracking(){document.addEventListener("copy",(e=>{const a=t.getSelection().toString();a&&a.trim().length>0&&this.track("copy",{semanticGroup:t.location.pathname,id:"copy_text",type:"clipboard",action:"copy",value:a.length>100?a.slice(0,100)+"â€¦":a})}))}flush(){if(0===this.buffer.length)return;const t=[...this.buffer];this.buffer=[],console.log("MoveoOne: Sending events",t),t.forEach(((t,e)=>{console.log(`Event ${e}:`,{type:t.type,context:t.c,sessionId:t.sId,meta:t.meta,additionalMetadata:t.additionalMetadata})})),fetch(e,{method:"POST",headers:{Authorization:this.token,"Content-Type":"application/json"},body:JSON.stringify({events:t})}).catch((t=>console.error("MoveoOne Error:",t)))}setupClickTracking(){document.addEventListener("click",(e=>{let a=e.target;if(!this.shouldTrackElement(a))return;if("A"===a.tagName&&a.href){const t=a.href.match(/\.(pdf|zip|docx?|xlsx?|pptx?|txt|csv|json|xml|gz|tar|rar|7z|exe|dmg|pkg|deb|rpm|iso|img|mp3|mp4|avi|mov|wmv|flv|webm|ogg|wav|flac)$/i),e=this.isOutboundLink(a.href);if(t||e)return}const i=this.getElementText(a),n={semanticGroup:t.location.pathname,id:a.id||a.className||a.tagName.toLowerCase()||"unnamed_element",type:a.tagName.toLowerCase(),action:"click",value:i};this.track("click",n)}))}setupScrollTracking(){let e,a=0;t.addEventListener("scroll",(()=>{clearTimeout(e),e=setTimeout((()=>{const e=t.scrollY,i=document.documentElement.scrollHeight-t.innerHeight,n=Math.round(e/i*100);Math.abs(e-a)>100&&(this.track("scroll",{semanticGroup:t.location.pathname,id:"page_scroll",type:"scroll",action:"scroll",value:n.toString()}),a=e)}),500)}))}setupFormTracking(){document.addEventListener("submit",(e=>{const a=e.target;this.track("form_submit",{semanticGroup:t.location.pathname,id:a.id||a.name||"unnamed_form",type:"form",action:"submit",value:""})})),document.addEventListener("change",(e=>{const a=e.target;["select","input","textarea"].includes(a.tagName.toLowerCase())&&this.track("form_change",{semanticGroup:t.location.pathname,id:a.id||a.name||"unnamed_input",type:a.type||a.tagName.toLowerCase(),action:"change",value:"password"===a.type?"[REDACTED]":a.value})}))}setupResizeTracking(){let e;t.addEventListener("resize",(()=>{clearTimeout(e),e=setTimeout((()=>{const e={width:t.innerWidth,height:t.innerHeight};(Math.abs(e.width-this.currentViewport.width)>50||Math.abs(e.height-this.currentViewport.height)>50)&&(this.track("viewport_resize",{semanticGroup:t.location.pathname,id:"viewport_change",type:"resize",action:"resize",value:`${e.width}x${e.height}`}),this.currentViewport=e)}),300)}))}getElementPath(t){const e=[];for(;t&&t.nodeType===Node.ELEMENT_NODE;){let a=t.nodeName.toLowerCase();t.id?a+="#"+t.id:t.className&&(a+="."+t.className.replace(/\s+/g,".")),e.unshift(a),t=t.parentNode}return e.join(" > ")}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}}t.MoveoOne={init:function(e,i={}){const n=new a(e),o=["locale","test","softwareVersion"];return Object.keys(i).forEach((t=>{if(o.includes(t))switch(t){case"locale":"string"==typeof i[t]&&(n.meta.locale=i[t]);break;case"test":"string"==typeof i[t]&&(n.meta.test=i[t]);break;case"softwareVersion":"string"==typeof i[t]&&(n.meta.softwareVersion=i[t])}else console.warn(`MoveoOne: Invalid meta field "${t}" ignored. Allowed fields: ${o.join(", ")}`)})),n.initialize(),t.MoveoOne.instance=n,n}}}(window);